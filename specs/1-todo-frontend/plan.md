# Implementation Plan: Next.js Todo Frontend

**Branch**: `1-todo-frontend` | **Date**: 2026-01-05 | **Spec**: [specs/1-todo-frontend/spec.md](../specs/1-todo-frontend/spec.md)

**Note**: This template is filled in by the `/sp.plan` command. See `.specify/templates/commands/plan.md` for the execution workflow.

## Summary

Implementation of a responsive, authenticated Todo frontend using Next.js App Router with Better Auth integration. The application will provide secure user authentication (signup/login), task management (CRUD operations), and a beautiful, professional UI that meets SaaS-grade quality standards. The frontend will communicate with a REST API via JWT-secured requests, treating the backend as the single source of truth.

## Technical Context

**Language/Version**: TypeScript with Next.js 16+ (App Router)
**Primary Dependencies**: Next.js, React, Tailwind CSS, Better Auth, JWT handling libraries
**Storage**: Client-side JWT token storage for session management
**Testing**: To be determined (NEEDS CLARIFICATION)
**Target Platform**: Web application (desktop, tablet, mobile)
**Project Type**: Frontend web application
**Performance Goals**: Fast loading, responsive interactions, sub-3-second task operations
**Constraints**: Must follow JWT security, responsive design, SaaS-quality UI standards
**Scale/Scope**: Single-user task management with multi-user backend support

## Constitution Check

*GATE: Must pass before Phase 0 research. Re-check after Phase 1 design.*

- ✅ Agentic Dev Stack compliance: Following spec → plan → tasks → Claude Code implementation
- ✅ Technology stack compliance: Using Next.js 16+, TypeScript, Tailwind CSS as required
- ✅ Authentication compliance: Using Better Auth as specified in constitution
- ✅ Security compliance: JWT-secured requests as required
- ✅ UI/UX compliance: Meeting SaaS-grade quality standards as specified
- ✅ No manual coding: All code will be generated by Claude Code only

## Project Structure

### Documentation (this feature)

```text
specs/1-todo-frontend/
├── plan.md              # This file (/sp.plan command output)
├── research.md          # Phase 0 output (/sp.plan command)
├── data-model.md        # Phase 1 output (/sp.plan command)
├── quickstart.md        # Phase 1 output (/sp.plan command)
├── contracts/           # Phase 1 output (/sp.plan command)
└── tasks.md             # Phase 2 output (/sp.tasks command - NOT created by /sp.plan)
```

### Source Code (repository root)

```text
frontend/
├── app/
│   ├── login/
│   │   └── page.tsx
│   ├── register/
│   │   └── page.tsx
│   ├── tasks/
│   │   └── page.tsx
│   ├── layout.tsx
│   └── page.tsx
├── components/
│   ├── TaskCard.tsx
│   ├── TaskForm.tsx
│   ├── Navbar.tsx
│   ├── AuthForm.tsx
│   └── ProtectedRoute.tsx
├── lib/
│   ├── api.ts        # API client
│   └── auth.ts       # Better Auth helpers
├── styles/
│   └── globals.css
├── types/
│   └── index.ts
├── .env.local
├── next.config.js
├── package.json
├── tailwind.config.js
└── tsconfig.json
```

**Structure Decision**: Single web application frontend structure with Next.js App Router following the specified folder structure from the specification.

## Phase 0: Research & Architecture

### 1. Architecture Blueprint

**Next.js App Router Architecture:**
- Pages: `/login`, `/register`, `/tasks`, shared layout
- Components: Reusable UI elements with professional-grade design
- API Layer: Centralized API client in `lib/api.ts` with JWT handling
- Auth/Session: Better Auth integration with JWT lifecycle management

**Separation of Concerns:**
- **Pages**: Route-level components handling specific user journeys
- **Components**: Reusable UI elements with consistent design system
- **API Layer**: Centralized client with JWT attachment and error handling
- **Auth/Session**: Better Auth integration with proper JWT lifecycle

### 2. Page-Level Breakdown

**`/login` page:**
- Purpose: User authentication with email/password
- UI responsibilities: Login form with validation, error states, loading states
- Auth requirements: Unprotected (public access)
- API interactions: Authentication endpoint
- Error & loading states: Form validation errors, API errors, loading indicators

**`/register` page:**
- Purpose: New user registration
- UI responsibilities: Registration form with validation, error states, loading states
- Auth requirements: Unprotected (public access)
- API interactions: User creation endpoint
- Error & loading states: Form validation errors, API errors, loading indicators

**`/tasks` page:**
- Purpose: Task management (CRUD operations)
- UI responsibilities: Task list, task creation form, task cards with completion toggle
- Auth requirements: Protected (requires authentication)
- API interactions: Task CRUD endpoints
- Error & loading states: Loading states, error states, empty states

**Shared layout and navigation:**
- Purpose: Consistent application structure
- UI responsibilities: Navigation, global styles, authentication state display
- Auth requirements: Conditionally render based on auth state

### 3. Component Design Plan

**`Navbar.tsx`:**
- Reusable navigation component
- Displays user authentication state
- Responsive design for mobile/desktop

**`TaskCard.tsx`:**
- Displays individual task with title, description, completion status
- Includes completion toggle, edit, and delete functionality
- Implements hover, focus, disabled states

**`TaskForm.tsx`:**
- Form for creating and updating tasks
- Includes validation and error handling
- Implements proper form states

**`AuthForm.tsx`:**
- Shared authentication form component for login/register
- Handles form validation and submission
- Implements loading and error states

**`ProtectedRoute.tsx`:**
- Higher-order component for route protection
- Redirects unauthenticated users to login
- Handles JWT presence validation

### 4. API Integration Strategy

**Centralized API Client (`lib/api.ts`):**
- Single API client instance for all backend communications
- JWT token attachment mechanism in Authorization header
- Error handling for 401 (force logout) and 403 (access error)
- Request/response normalization for UI consumption

**JWT Attachment Mechanism:**
- Automatically attach `Authorization: Bearer <token>` to all authenticated requests
- Handle token refresh if needed
- Proper error handling when token is missing or invalid

**Error Handling Strategy:**
- 401 responses → Force logout and redirect to login
- 403 responses → Show access error to user
- Other errors → Display appropriate user feedback
- Network errors → Show connectivity issues

### 5. Authentication & Session Plan

**Better Auth Integration Flow:**
- Initialize Better Auth client for user session management
- Handle JWT token retrieval and storage
- Implement proper session lifecycle (login, logout, session validation)

**JWT Lifecycle Handling:**
- Store JWT tokens securely on the client-side
- Validate JWT presence before API requests
- Handle token expiration gracefully
- Implement automatic logout when token expires

**Route Protection Enforcement:**
- Create middleware/Higher-Order Component for protected routes
- Check JWT presence before allowing access to protected pages
- Redirect to login page if JWT is missing or invalid

**Logout Invalidation Behavior:**
- Clear JWT token from client storage
- Redirect to login page
- Reset application state

**Frontend Trust Boundaries:**
- JWT-only authority for authentication state
- Always verify JWT presence for protected actions
- Never trust unauthenticated state

### 6. UI/UX Execution Plan

**Design System Enforcement:**
- Consistent typography (font families, sizes, weights)
- Consistent spacing system (using Tailwind spacing classes)
- Consistent color palette (primary, secondary, success, error, warning)
- Clear visual hierarchy for actions and content

**Responsive Behavior Rules:**
- Mobile-first approach with progressive enhancement
- Proper touch targets for mobile interactions
- Desktop-optimized layouts with additional features
- Tablet-responsive design bridging mobile and desktop

**UX Flows:**
- First-time user: Clear onboarding, simple signup process
- Authenticated user: Intuitive task management workflow
- Error scenarios: Clear error messages, recovery paths

**Visual Feedback Plan:**
- Hover states for all interactive elements
- Focus states for all form elements
- Loading states for all API operations
- Success/error feedback for all user actions
- Immediate visual feedback for all interactions

### 7. Task Decomposition Strategy

Each task will be atomic and Claude-executable:
- Map directly back to functional requirements in the specification
- Be small enough for single-agent execution
- Produce verifiable output
- Follow the beautiful, professional, advanced UI standards

### 8. Validation & Review Gates

**Spec Compliance Check:**
- All functional requirements implemented
- All success criteria met
- UI meets SaaS-grade quality standards

**No Extra Features Check:**
- Only implement features specified in the spec
- No additional functionality beyond requirements

**Missing Requirements Check:**
- All requirements from the spec addressed
- No gaps in functionality

**UI Quality Enforcement:**
- Beautiful, professional, advanced design
- Consistent visual system
- Proper component states

**JWT Security Correctness:**
- Proper token handling
- Secure storage
- Correct error handling for authentication failures

## Complexity Tracking

> **Fill ONLY if Constitution Check has violations that must be justified**

| Violation | Why Needed | Simpler Alternative Rejected Because |
|-----------|------------|-------------------------------------|
| None identified | N/A | N/A |