---
id: 005
title: FastAPI Backend Specification
stage: spec
date: 2026-01-06
surface: agent
model: claude-sonnet-4-5
feature: 002-fastapi-backend
branch: 002-fastapi-backend
user: user
command: /sp.specify
labels: ["backend", "fastapi", "jwt-auth", "postgresql", "neon", "rest-api", "specification"]
links:
  spec: specs/002-fastapi-backend/spec.md
  ticket: null
  adr: null
  pr: null
files:
  - specs/002-fastapi-backend/spec.md
  - specs/002-fastapi-backend/checklists/requirements.md
tests:
  - Specification quality validation checklist (all checks passed)
---

## Prompt

/sp.specify

  Project: Hackathon II ‚Äì Todo Full-Stack Web Application
  Phase: Phase II (Backend Only)
  Scope: FastAPI Backend + Neon DB + JWT Auth Integration

  ---

  ## Objective
  Build a **secure, production-grade FastAPI backend** that integrates seamlessly with the completed Next.js frontend, using **JWT
  authentication from Better Auth** and **persistent storage via Neon PostgreSQL**, strictly following **Spec-Kit Plus + Claude Code agentic
  workflow**.

  ---

  ## Development Rules (Strict)
  - Workflow: **Specification ‚Üí Plan ‚Üí Tasks ‚Üí Claude Code**
  - **Manual coding is forbidden**
  - All backend code must be generated by **Claude Code**
  - No implementation without this spec
  - Any deviation ‚Üí **Phase II Backend invalidated**

  ---

  ## In Scope
  - REST API for Todo task management
  - JWT verification using Better Auth
  - Per-user data isolation
  - Persistent storage with Neon PostgreSQL
  - Full frontend compatibility

  ---

  ## Authentication & Security
  - Auth handled on frontend (Better Auth)
  - Backend must:
    - Read JWT from `Authorization: Bearer <token>`
    - Verify JWT using shared secret
    - Extract user identity
    - Enforce user ownership on all operations

  ### Environment Variables (Mandatory)
  ```env
  BETTER_AUTH_SECRET=PU0Tdg9Y0rvcqOFEPtwYhWwDdyPIp20g
  BETTER_AUTH_URL=http://localhost:3000
  NEON_DATABASE_URL=postgresql://...
  ```

  REST API (Locked) base path /api/{user_id}/tasks

  | Method | Endpoint                             | Description       |
  | ------ | ------------------------------------ | ----------------- |
  | GET    | `/api/{user_id}/tasks`               | List tasks        |
  | POST   | `/api/{user_id}/tasks`               | Create task       |
  | GET    | `/api/{user_id}/tasks/{id}`          | Get task          |
  | PUT    | `/api/{user_id}/tasks/{id}`          | Update task       |
  | DELETE | `/api/{user_id}/tasks/{id}`          | Delete task       |
  | PATCH  | `/api/{user_id}/tasks/{id}/complete` | Toggle completion |

  Rules:
  - JWT required on every request
  - URL user_id must match JWT user
  - 401 ‚Üí no token / invalid token
  - 403 ‚Üí user mismatch

  Task Model:
  - id (int, PK)
  - user_id (string, indexed)
  - title (required, ‚â§200 chars)
  - description (optional, ‚â§1000 chars)
  - completed (bool, default false)
  - created_at, updated_at (timestamps)

  Database:
  - Neon Serverless PostgreSQL
  - ORM: SQLModel
  - User-scoped queries only
  - Database = single source of truth

  Backend Structure (Mandatory):
  ```
  backend/
  ‚îú‚îÄ‚îÄ main.py
  ‚îú‚îÄ‚îÄ db.py
  ‚îú‚îÄ‚îÄ models.py
  ‚îú‚îÄ‚îÄ auth/jwt.py
  ‚îú‚îÄ‚îÄ routes/tasks.py
  ‚îú‚îÄ‚îÄ dependencies.py
  ‚îú‚îÄ‚îÄ CLAUDE.md
  ‚îî‚îÄ‚îÄ .env
  ```

  Quality & Validation:
  - Code must be: modular, minimal, secure
  - Proper HTTP status codes only
  - No undocumented behavior allowed

  Success Criteria:
  - Frontend works without modification
  - All CRUD operations succeed
  - JWT enforced on every endpoint
  - Users cannot access others' tasks
  - Data persists correctly in Neon DB

## Response snapshot

Created comprehensive specification for FastAPI backend with JWT authentication and Neon PostgreSQL integration.

**Specification Structure:**
- **6 prioritized user stories** (P1: Create & Read tasks as MVP, P2: Update & Toggle completion, P3: Delete & Get single task)
- **20 functional requirements** covering JWT validation, data isolation, database persistence, API contracts, security, and configuration
- **10 success criteria** with measurable metrics (2s response time, 100% data isolation, 50 concurrent users, 500ms p95 latency)
- **8 edge cases** addressing token expiration, validation errors, database failures, concurrent updates, and security scenarios
- **9 documented assumptions** about database connection, JWT format, pagination, ordering, timezone handling, CORS, rate limiting, and data retention

**Key Design Decisions:**
- Priority-based user story structure enables incremental delivery (MVP with just P1 stories)
- Complete data isolation enforced through user_id scoping on all operations
- Technology-agnostic success criteria focused on user outcomes
- Comprehensive security requirements (FR-001 to FR-005, FR-016 to FR-017)
- Clear API contract with HTTP status code specifications

**Validation Results:**
All specification quality checks passed:
- No implementation details in specification
- All requirements testable and unambiguous
- Success criteria measurable and technology-agnostic
- Complete acceptance scenarios for all user stories
- Edge cases and assumptions documented

**Branch & Files:**
- Branch: `002-fastapi-backend`
- Spec: `specs/002-fastapi-backend/spec.md`
- Checklist: `specs/002-fastapi-backend/checklists/requirements.md`

## Outcome

- ‚úÖ Impact: Complete specification created for FastAPI backend with JWT auth and Neon PostgreSQL. Defines 6 user stories, 20 functional requirements, 10 success criteria, and 8 edge cases. Enables planning and implementation phases.
- üß™ Tests: Specification quality validation checklist created and passed all checks
- üìÅ Files: specs/002-fastapi-backend/spec.md (176 lines), specs/002-fastapi-backend/checklists/requirements.md
- üîÅ Next prompts: Run `/sp.clarify` to refine unclear areas (optional), or run `/sp.plan` to begin architectural planning and design
- üß† Reflection: Specification successfully balances completeness with clarity. Priority-based structure enables MVP delivery. All requirements testable. Assumptions documented for future reference. Ready for planning phase.

## Evaluation notes (flywheel)

- Failure modes observed: None - specification generation completed successfully on first attempt
- Graders run and results (PASS/FAIL): Specification quality checklist - PASS (all 12 validation items passed)
- Prompt variant (if applicable): Standard /sp.specify workflow with detailed user input
- Next experiment (smallest change to try): Proceed to `/sp.plan` to generate architectural design and implementation approach
